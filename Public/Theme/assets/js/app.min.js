$(function(){$.fn.datetimepicker.dates["zh-CN"]={days:["星期日","星期一","星期二","星期三","星期四","星期五","星期六","星期日"],daysShort:["周日","周一","周二","周三","周四","周五","周六","周日"],daysMin:["日","一","二","三","四","五","六","日"],months:["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"],monthsShort:["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"],today:"今天",suffix:[],meridiem:["上午","下午"]},$("body").on("submit",".ajax-submit",function(){var t=$(this).attr("action"),e=$(this);return $.ajaxsubmit({url:t,data:e.serialize()},function(){}),!1}),$("body").on("click",".ajax-click",function(){var t,e=$(this).attr("href"),n=!1;if($(this).hasClass("am-disabled"))return!1;if($(this).hasClass("ajax-dialog")&&(t=$(this).attr("msg")?$(this).attr("msg"):"确定删除吗？",confirm(t)||(n=!0)),1==n)return!1;n=$('input[name="token"]').val();return $.ajaxsubmit({url:e,data:{token:n}},function(){}),!1}),$.ajaxsubmit=function(t,n){var i={url:"",data:{"":""},dialog:!0};$.extend(i,t);var a=$.AMUI.progress,r={id:"submit-tips",zIndex:"9999",fixed:!0,skin:"submit-warning"};a.start(),$.post(i.url,i.data,function(t){var e=t?.token||!1;if(1==i.dialog){if(200==t.status){if(r.content='<i class="am-icon-check-circle"></i>  ',r.skin="submit-success",-1==t.waitSecond)return $.refreshToken(e),window.location.href=t.url,!1;setTimeout(function(){t.url?window.location.href=t.url:location.reload()},2e3)}else r.content='<i class="am-icon-exclamation-circle"></i>  ';r.content+=t.msg}$.refreshToken(e),n(t)},"JSON").fail(function(t,e,n){var i="系统请求出错！请再次提交!";try{switch($.refreshToken(t.responseJSON.token),t.responseJSON.status){case 500:case 404:i=t.responseJSON.msg}}catch(t){}r.skin="submit-error",r.content='<i class="am-icon-times-circle"></i> '+i}).complete(function(){var t,e;1==i.dialog&&(t=dialog(r).showModal(),e=$(".refresh-verify").attr("src"),$(".refresh-verify").attr("src",e+"&time="+Math.random()),setTimeout(function(){t.close().remove()},3e3)),a.done()})},$.refreshToken=function(t){0!=t&&(localStorage.setItem("token",t),$("input[name=token]").each(function(){$(this).val(t)}))};var t;t="",$("input[name=token]").each(function(){t=$(this).val()}),""!=t&&localStorage.setItem("token",t);setInterval(function(){var t,e="";$("input[name=token]").each(function(){e=$(this).val()}),""!=e&&(t=localStorage.getItem("token"),e!=t&&$.getJSON(PESCMS_PATH+"/?g=Form&m=Index&a=token",function(t){t=t?.token||!1;0==t?console.log("警告: 当前页面令牌数据已过时，您可能与服务器断网了链接。"):$.refreshToken(t)}))},2e4),$("body").on("blur",".icon-input",function(){var t=$(this).attr("name");$("."+t).attr("class",$(this).val()+" "+t)}),$(".color-input").spectrum({preferredFormat:"hex",showInput:!0}),$(".datetimepicker").datetimepicker({language:"zh-CN",format:"yyyy-mm-dd hh:00",maxView:"2",minView:"1",autoclose:!0}),$(document).on("click",".refresh-verify",function(){var t=$(this).attr("src");$(this).attr("src",t+"&time="+Math.random())}),$(".display-verify").on("click",function(){$(this).remove(),$(".refresh-verify").removeClass("am-hide").attr("src",PESCMS_PATH+"/?m=Index&a=verify&time="+Date.parse(new Date)+Math.random())}),$(".print-ticket").on("click",function(){var t=$(this).attr("href");return window.open(t,"","width=800,height=600"),!1}),$(".checkbox-all").on("click, change",function(){1==$(this).prop("checked")?$(".checkbox-all-children").prop("checked","checked"):$(".checkbox-all-children").removeAttr("checked")}),$(".delete-batch").on("click",function(){var t=$(this).attr("data"),e=$(".checkbox-all-children").serialize();if(!e)return alert("您没有勾选要删除的数据."),!1;if(confirm("确认进行批量删除所勾选数据吗？")){var n=$('input[name="token"]').val();return $.ajaxsubmit({url:t,data:e+"&token="+n},function(){}),!1}return!1})});